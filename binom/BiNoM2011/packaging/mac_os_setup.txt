#
#
# Setup for NaviCell server on Mac OS X 
# version tested: el capitan 10.11.1
# written by Eric Bonnet 12.2015
#
#

Requirements:
  - xcode command line tools installed (type 'xcode-select -p' in a terminal window)
  - R installed (https://cran.r-project.org/bin/macosx/)
  - up-to-date Java installation
  - Google Chrome installed


#----------------------------------------------------
#  Build and test the package (without apache server)
#----------------------------------------------------

# svn URL: https://svn.curie.fr/svn/U900/research/software-dvt/binom/trunk/binom/BiNoM2011
# checkout the lastest version of BiNoM package, 
# then change directory to 'packaging'
# target directory for the package: /Users/eric/tmp/
sh make_navicell_package.sh /Users/eric/tmp/

# Go to target directory and un-tar package 
tar xzvf navicell.2.1.tgz 

# go to 'examples' and build test map (Cell Cycle) 
cd navicell/factory/examples/
sh build_cellcycle_map.sh ../../site/docroot/navicell/maps

# Open Google Chrome browser with specific option in order to navigate 
# the map in 'file' mode
open -a "Google Chrome" --args --allow-file-access-from-files

# Open the map with this URL
file:///Users/eric/tmp/navicell/site/docroot/navicell/maps/cellcycle/master/index.html

#----------------------------------------------
# Apache server configuration on local computer
#----------------------------------------------

# edit the apache configuration file
sudo edit /etc/apache2/httpd.conf

#-- uncomment the lines:
LoadModule php5_module libexec/apache2/libphp5.so
LoadModule cgi_module libexec/apache2/mod_cgi.so

# Uncomment this line and add .py support
AddHandler cgi-script .cgi .py

# restart the apache server
sudo apachectl start

# change to the default cgi-bin default location and 
# copy all cgi-bin files:
cd /Library/WebServer/CGI-Executables/
sudo cp -r /Users/eric/tmp/navicell/site/cgi-bin/* .

# set the permissions to read & execute
sudo bash
find . | xargs chmod a+rx
exit

# FIXME: edit python script with correct Rscript binary path on local host:
Rcmd = "/usr/local/bin/Rscript script.R " ....

# cd to the default html location 
cd /Library/WebServer/Documents/

# copy all files
sudo cp -r /Users/eric/tmp/navicell/site/docroot/* .

# set correct permissions for all files and directories
sudo bash
find navicell/ data/ -type d | xargs chmod a+rx
find navicell/ data/ \! -type d | xargs chmod a+r
exit

# test URLs
http://localhost/navicell/maps/cellcycle/master/index.html
http://localhost/navicell/maps/cellcycle/master/index.php



